<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ì´ ë¶€ë¶„ì´ ê°€ìž¥ ì¤‘ìš”í•©ë‹ˆë‹¤. namespaceëŠ” DAO ì¸í„°íŽ˜ì´ìŠ¤ì˜ ì „ì²´ ê²½ë¡œì™€ ë°˜ë“œì‹œ ê°™ì•„ì•¼ í•¨ ì´ê±¸ë¡œ MyBatisê°€ 
	ðŸ‘‰ â€œì•„, ì´ XMLì€ PostDAOëž‘ ì—°ê²°ë˜ëŠ”êµ¬ë‚˜â€ ë¼ê³  ì¸ì‹í•¨ -->
<mapper namespace="kr.hi.boot.dao.PostDAO">
	<!-- ìš”ì†Œ ì˜ë¯¸ id DAO ë©”ì„œë“œ ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•¨ resultType SQL ê²°ê³¼ë¥¼ ì–´ë–¤ ê°ì²´ë¡œ ë‹´ì„ì§€ -->

	<!-- 1. - XMLì˜ id = DAO ë©”ì„œë“œëª… (ì´ë¦„ì´ ë‹¤ë¥´ë©´ ì‹¤í–‰ ì•ˆ ë¨ (ì—ëŸ¬ ë°œìƒ)) 2. - resultType = 
		ë°˜í™˜ íƒ€ìž… SQL ê²°ê³¼ í•œ í–‰ â†’ Board ì—¬ëŸ¬ í–‰ â†’ ArrayList<Board> -->
	<select id="getBoardList" resultType="Board">
		select * from board
	</select>
	<!-- - select íƒœê·¸ë§Œ resultType ë˜ëŠ” resultMapì´ í•„ìš” - updata, insert, deleteëŠ” 
		í•„ìš” ì—†ìŒ - DAOì˜ ë¦¬í„´íƒ€ìž…ìœ¼ë¡œ boolean, int ì§€ì • ê°€ëŠ¥. mapperì—ì„œëŠ” ë”°ë¡œ ì§€ì •í•  í•„ìš” ì—†ìŒ -->
	<insert id="insertBoard">
		insert into board(bo_name) value (#{name})
	</insert>
	<delete id="deleteBoard">
		delete from board where bo_num = #{num}
	</delete>
	<update id="updateBoard">
		update board
		set
		bo_name = #{name}
		where
		bo_num = #{num}
	</update>
	<select id="getPostList" resultType="Post">
		select * from post
		where
		po_del = 'N'
		<!-- ê²Œì‹œíŒì— ë§žëŠ” ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ -->
		<if test="cri.boNum != 0">
			and po_bo_num = #{cri.boNum}
		</if>
		<!-- ê²€ìƒ‰ ì¡°ê±´ì— ë§žëŠ” ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ -->
		<choose>
			<!-- ì „ì²´ ê²€ìƒ‰ -->
			<when test='cri.type == "A"'>
				and(
				po_title like concat('%', #{cri.search}, '%')or
				po_content like concat('%', #{cri.search}, '%')or
				po_me_id = #{cri.search}
				)
			</when>
			<!-- ì œëª©+ë‚´ìš© ê²€ìƒ‰ -->
			<when test='cri.type == "TC"'>
				and(
				po_title like concat('%', #{cri.search}, '%')or
				po_content like concat('%', #{cri.search}, '%')
				)
			</when>
			<!-- ìž‘ì„±ìž ê²€ìƒ‰ -->
			<when test='cri.type == "W"'>
				and po_me_id = #{cri.search}
			</when>
		</choose>
		order by po_num desc
		limit #{cri.pageStart}, #{cri.perPageNum}
	</select>
	<select id="getPost" resultType="Post">
		select * from post
		where
		po_num = #{num}
	</select>
	<select id="getBoard" resultType="Board">
		select * from board
		where
		bo_num = #{num}
	</select>
	<insert id="insertPost">
		insert into post(po_title, po_content, po_me_id,
		po_bo_num)
		values(#{post.title},#{post.content},
		#{post.id},#{post.board})
	</insert>
	<update id="updatePostView">
		update post set po_view = po_view + 1
		where po_num =
		#{num}
	</update>
	<select id="selectPostListCount" resultType="int">
		select count(*) from post
		where po_del = 'N'
		<!-- ê²Œì‹œíŒ ì¡°ê±´ -->
		<if test="cri.boNum != 0">
			and po_bo_num = #{cri.boNum}
		</if>
		<choose>
			<!-- ì „ì²´ ê²€ìƒ‰ -->
			<when test='cri.type == "A"'>
				and(
				po_title like concat('%', #{cri.search}, '%')or
				po_content like concat('%', #{cri.search}, '%')or
				po_me_id = #{cri.search}
				)
			</when>
			<!-- ì œëª©+ë‚´ìš© ê²€ìƒ‰ -->
			<when test='cri.type == "TC"'>
				and(
				po_title like concat('%', #{cri.search}, '%')or
				po_content like concat('%', #{cri.search}, '%')
				)
			</when>
			<!-- ìž‘ì„±ìž ê²€ìƒ‰ -->
			<when test='cri.type == "W"'>
				and po_me_id = #{cri.search}
			</when>
		</choose>
	</select>
	<update id="deletePost">
	<!-- ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ ì´ìš©í•˜ì—¬ ê²Œì‹œê¸€ì˜ po_delë¥¼ Yë¡œ ìˆ˜ì •í•˜ëŠ” ì¿¼ë¦¬ìž‘ì„± -->
		update post set po_del = 'Y'
		where po_num = #{poNum}
	</update>
	
	<update id="updatePost">
		update post 
			set 
			po_title = #{dto.title},
			po_content = #{dto.content}
			where
			po_num = #{poNum}
	</update>
</mapper>